<div class="create-story-container">
  <form [formGroup]="form" (ngSubmit)="onSubmit()">

    <app-story-info [parent]="form"></app-story-info>

    <div class="publish-box">
      <h2>Publish</h2>
      <label for="date">Date</label>
      <input
        id="date"
        formControlName="date"
        type="text">
      <app-select-users
        [parent]="form"
        [users]="users">
      </app-select-users>
      <button
        type="submit"
        [disabled]="
          form.get('title').invalid || 
          form.get('content').invalid">
        Create Story
      </button>
      <button
        (click)="formReset()"
        type="button">Reset Story</button>
    </div>

    <app-checkbox-categories
      [parent]="form"
      [controlName]="categoryControlName"
      [categories]="hierarchyCategories"
      (checkedCategory)="categorySelection($event)">
    </app-checkbox-categories>


    <div class="content-box">
      <h2>Story Content</h2>
      <p-editor
        [style]="{'background-color': 'white', 'height': '25em'}"
        formControlName="content"
        placeholder="Story">
        <p-header>
          <span class="ql-formats">
            <button class="ql-bold" type="button" type="button"></button>
            <button class="ql-italic" type="button"></button>
            <button class="ql-underline" type="button"></button>
          </span>
          <span class="ql-formats">
            <button class="ql-script" value="sub" type="button"></button>
            <button class="ql-script" value="super" type="button"></button>
          </span>
          <span class="ql-formats">
            <button class="ql-header" value="2" type="button"></button>
            <button class="ql-list" value="ordered" type="button"></button>
            <button class="ql-list" value="bullet" type="button"></button>
          </span>
          <span class="ql-formats">
            <button class="ql-link" type="button"></button>
          </span>
        </p-header>
      </p-editor>
    </div>

    <app-story-pictures
      [parent]="form"
      [fileList]="_pictures.value"
      (removed)="removePicture($event)"
      (edit)="editPicture($event)">
      <button
        (click)="toggleAddPicture()"
        type="button">Add Picture</button>
      <button 
        (click)="resetPictureArray()"
        type="button">Remove all</button>
    </app-story-pictures>

    <pre>
{{form.value | json}}
    </pre>

    <app-featured-image 
      [imageUrl]="form.get('featuredImage').value">
    </app-featured-image>


    <div *ngIf="editArray" class="edit-array__container">
      <div class="edit-array" formArrayName="pictures">
        <div *ngFor="let picture of _pictures.controls; let i = index;" [formGroupName]="i">
          <h4>Index: {{i}}</h4>
          <input
            id="title"
            class="picture-title"
            type="text" 
            placeholder="This will be used to create the URL link of the photo" 
            formControlName="title">

          <input
            class="picture-caption"
            type="text" 
            placeholder="This text will appear along with the photo"
            formControlName="caption">

          <input
            type="text" 
            placeholder="This text describes the photo for accessibility"
            formControlName="altText">
        </div>
        <button type="button" (click)="editArray = false">Close</button>
      </div>
      
    </div>

  </form>

  <app-file-uploader 
    (filesToUpload)="filesToUpload($event)"
    *ngIf="addingPicture">

    <button
      (click)="toggleAddPicture()"
      type="button">Finished</button>
  </app-file-uploader>

 

  <!--<div class="picture-box" *ngIf="addingPicture">
    <app-story-picture
      [parent]="form"
      (added)="addPicture($event)"
      (pictureReset)="resetPicture()">
      <button
        (click)="toggleAddPicture()"
        type="button">Cancel</button>
    </app-story-picture>
  </div>-->
  
</div>